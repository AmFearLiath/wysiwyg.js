!function(e){"use strict";"function"==typeof define&&define.amd?define([],function(){return e(window,document)}):"undefined"!=typeof exports?module.exports=e(window,document):window.wysiwyg=e(window,document)}(function(e,t){"use strict";var n=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var i=this,o=arguments;r=setTimeout(function(){r=null,e.apply(i,o)},t)}},r=function(t,n,r,i){t.addEventListener?t.addEventListener(n,r,i?!0:!1):t.attachEvent?t.attachEvent("on"+n,r):t!=e&&(t["on"+n]=r)},i=function(t,n,r,i){t.removeEventListener?t.removeEventListener(n,r,i?!0:!1):t.detachEvent?t.detachEvent("on"+n,r):t!=e&&(t["on"+n]=null)},o=function(e,n,r,i){if(t.createEvent){var o=t.createEvent("Event");o.initEvent(n,void 0!==r?r:!0,void 0!==i?i:!1),e.dispatchEvent(o)}else if(t.createEventObject){var o=t.createEventObject();e.fireEvent("on"+n,o)}else"function"==typeof e["on"+n]&&e["on"+n]()},a=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},l="undefined"!=typeof Node?Node.ELEMENT_NODE:1,u="undefined"!=typeof Node?Node.TEXT_NODE:3,f=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},s=function(n){if(e.getSelection){var r=e.getSelection();if(r.rangeCount>0)return r.getRangeAt(0)}else if(t.selection){var r=t.selection;return r.createRange()}return null},d=function(n,r){if(r)if(e.getSelection){var i=e.getSelection();i.removeAllRanges(),i.addRange(r)}else t.selection&&r.select()},g=function(){if(e.getSelection){var n=e.getSelection();if(!n.rangeCount)return!1;var r=n.getRangeAt(0).cloneRange();if(r.getBoundingClientRect){var i=r.getBoundingClientRect();if(i&&i.left&&i.top&&i.right&&i.bottom)return{left:parseInt(i.left),top:parseInt(i.top),width:parseInt(i.right-i.left),height:parseInt(i.bottom-i.top)};for(var o=r.getClientRects?r.getClientRects():[],a=0;a<o.length;++a){var i=o[a];if(i.left&&i.top&&i.right&&i.bottom)return{left:parseInt(i.left),top:parseInt(i.top),width:parseInt(i.right-i.left),height:parseInt(i.bottom-i.top)}}}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var r=n.createRange();if(r.boundingLeft||r.boundingTop||r.boundingWidth||r.boundingHeight)return{left:r.boundingLeft,top:r.boundingTop,width:r.boundingWidth,height:r.boundingHeight}}}return!1},p=function(n){if(e.getSelection){var r=e.getSelection();return r.isCollapsed?!0:!1}if(t.selection){var r=t.selection;if("Text"==r.type){var i=t.selection.createRange(),o=t.body.createTextRange();return o.moveToElementText(n),o.setEndPoint("EndToStart",i),0==i.htmlText.length}if("Control"==r.type)return!1}return!0},v=function(n){if(e.getSelection){var r=e.getSelection();if(!r.rangeCount)return[];for(var i=[],o=0;o<r.rangeCount;++o)for(var a=r.getRangeAt(o),u=a.startContainer,s=a.endContainer;u;){if(u!=n){var d=!1;if(r.containsNode)d=r.containsNode(u,!0);else{var g=t.createRange();g.selectNodeContents(u);for(var o=0;o<r.rangeCount;++o){var a=r.getRangeAt(o);if(a.compareBoundaryPoints(a.END_TO_START,g)>=0&&a.compareBoundaryPoints(a.START_TO_END,g)<=0){d=!0;break}}}d&&i.push(u)}u=c(u,u==s?s:n)}return 0==i.length&&f(n,r.focusNode)&&r.focusNode!=n&&i.push(r.focusNode),i}if(t.selection){var r=t.selection;if("Text"==r.type){for(var i=[],p=r.createRangeCollection(),o=0;o<p.length;++o)for(var a=p[o],v=a.parentElement(),u=v;u;){var g=a.duplicate();if(g.moveToElementText(u.nodeType!=l?u.parentNode:u),g.compareEndPoints("EndToStart",a)>=0&&g.compareEndPoints("StartToEnd",a)<=0){for(var h=!1,m=0;m<i.length;++m)if(i[m]===u){h=!0;break}h||i.push(u)}u=c(u,v)}return 0==i.length&&f(n,t.activeElement)&&t.activeElement!=n&&i.push(t.activeElement),i}if("Control"==r.type){for(var i=[],a=r.createRange(),o=0;o<a.length;++o)i.push(a(o));return i}}return[]},h=function(){if(e.getSelection){var n=e.getSelection();if(!n.isCollapsed)try{n.collapseToEnd()}catch(r){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var i=n.createRange();i.collapse(!1),i.select()}}},m=function(n,r,i){if(e.getSelection){var o=e.getSelection();if(o.modify){for(var a=0;r>a;++a)o.modify("extend","backward","character");for(var a=0;i>a;++a)o.modify("extend","forward","character")}else{var l=o.getRangeAt(0);l.setStart(l.startContainer,l.startOffset-r),l.setEnd(l.endContainer,l.endOffset+i),o.removeAllRanges(),o.addRange(l)}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var l=o.createRange();l.collapse(!0),l.moveStart("character",-r),l.moveEnd("character",i),l.select()}}},T=function(n){if(p(n))return null;if(e.getSelection){var r=e.getSelection();if(r.rangeCount){for(var i=t.createElement("div"),o=r.rangeCount,a=0;o>a;++a){var l=r.getRangeAt(a).cloneContents();i.appendChild(l)}return i.innerHTML}}else if(t.selection){var r=t.selection;if("Text"==r.type){var u=r.createRange();return u.htmlText}}return null},y=function(n,r){if(e.getSelection){var i=e.getSelection();if(f(n,i.anchorNode)&&f(n,i.focusNode))return!0;if(!r)return!1;var o=t.createRange();o.selectNodeContents(n),o.collapse(!1),i.removeAllRanges(),i.addRange(o)}else if(t.selection){var i=t.selection;if("Control"==i.type){var o=i.createRange();if(0!=o.length&&f(n,o(0)))return!0}else{var a=t.body.createTextRange();a.moveToElementText(n);var o=i.createRange();if(a.inRange(o))return!0}if(!r)return!1;var o=t.body.createTextRange();o.moveToElementText(n),o.setEndPoint("StartToEnd",o),o.select()}return!0},E=function(n,r){if(e.getSelection){var i=e.getSelection();if(i.getRangeAt&&i.rangeCount){var o=i.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var l,u,c=t.createDocumentFragment();l=a.firstChild;)u=c.appendChild(l);f(n,o.commonAncestorContainer)?(o.deleteContents(),o.insertNode(c)):n.appendChild(c),u&&(o=o.cloneRange(),o.setStartAfter(u),o.collapse(!0),i.removeAllRanges(),i.addRange(o))}}else if(t.selection){var i=t.selection;if("Control"!=i.type){var s=i.createRange();s.collapse(!0);var o=i.createRange();if(f(n,o.parentElement()))o.pasteHTML(r);else{var d=t.body.createTextRange();d.moveToElementText(n),d.collapse(!1),d.select(),d.pasteHTML(r)}o=i.createRange(),o.setEndPoint("StartToEnd",s),o.select()}}},C=function(C){C=C||{};var b=C.element||null;"string"==typeof b&&(b=t.getElementById(b));var R=C.onKeyDown||null,S=C.onKeyPress||null,L=C.onKeyUp||null,N=C.onSelection||null,x=C.onPlaceholder||null,w=C.onClosepopup||null,M=C.hijackContextmenu||!1,I="TEXTAREA"==b.nodeName||"INPUT"==b.nodeName;if(I){var H="contentEditable"in t.body;if(H){var k=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);k&&420<=parseInt(k[1])&&parseInt(k[1])<534&&(H=!1)}if(!H){var A=b,P=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};A.value=P(A.value);var O=function(){return this},D=function(){return null};return{legacy:!0,getElement:function(){return A},getHTML:function(){return A.value},setHTML:function(e){return A.value=P(e),this},getSelectedHTML:D,sync:O,collapseSelection:O,expandSelection:O,openPopup:D,closePopup:O,removeFormat:O,bold:O,italic:O,underline:O,strikethrough:O,forecolor:O,highlight:O,fontName:O,fontSize:O,subscript:O,superscript:O,align:O,format:O,indent:O,insertLink:O,insertImage:O,insertHTML:O,insertList:O}}}var A=null,B=null;if(I){A=b,A.style.display="none",B=t.createElement("DIV"),B.innerHTML=A.value;var j=A.parentNode,K=A.nextSibling;K?j.insertBefore(B,K):j.appendChild(B)}else B=b;B.setAttribute("contentEditable","true");var X=t.all&&!t.addEventListener?t:e,W=null;if(I){var Y=B.innerHTML;W=function(){var e=B.innerHTML;e!=Y&&(A.value=e,Y=e,o(A,"change",!1))}}var _;if(x){var F=!1;_=function(){for(var e=!0,t=B;t;)if(t=c(t,B)){if(t.nodeType==l){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==u){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}}else;F!=e&&(x(e),F=e)},_()}var V=null,q=null,z=null;N&&(q=function(t,n,r){var i=p(B),o=v(B),a=null===t||null===n?null:{left:t,top:n,width:0,height:0},u=g();if(u&&(a=u),a){if(B.getBoundingClientRect){var f=B.getBoundingClientRect();a.left-=parseInt(f.left),a.top-=parseInt(f.top)}else{var c=B,s=0,d=0,h=!1;do s+=c.offsetLeft?parseInt(c.offsetLeft):0,d+=c.offsetTop?parseInt(c.offsetTop):0,"fixed"==c.style.position&&(h=!0);while(c=c.offsetParent);a.left-=s-(h?0:e.pageXOffset),a.top-=d-(h?0:e.pageYOffset)}a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>B.offsetWidth&&(a.width=B.offsetWidth),a.height>B.offsetHeight&&(a.height=B.offsetHeight)}else if(o.length)for(var m=0;m<o.length;++m){var c=o[m];if(c.nodeType==l){a={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}}N(i,a,o,r)},z=n(q,1));var U=null,G=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==u&&(n=n.parentNode),f(U,n)||Q()},J=function(){if(U)return U;r(X,"mousedown",G,!0),U=t.createElement("DIV");var e=B.parentNode,n=B.nextSibling;return n?e.insertBefore(U,n):e.appendChild(U),U},Q=function(){U&&(U.parentNode.removeChild(U),U=null,i(X,"mousedown",G,!0),w&&w())};r(B,"focus",function(){A&&o(A,"focus",!1)}),r(B,"blur",function(){W&&W(),A&&o(A,"blur",!1)});var Z=null;if(_||W){var $=W?n(W,250,!0):null,ee=function(e){_&&_(),$&&$()};Z=n(ee,1),r(B,"input",Z),r(B,"DOMNodeInserted",Z),r(B,"DOMNodeRemoved",Z),r(B,"DOMSubtreeModified",Z),r(B,"DOMCharacterDataModified",Z),r(B,"propertychange",Z),r(B,"textInput",Z),r(B,"paste",Z),r(B,"cut",Z),r(B,"drop",Z)}var te=function(t,n){if(!t)var t=e.event;var r=t.which||t.keyCode,i=String.fromCharCode(r||t.charCode),o=t.shiftKey||!1,l=t.altKey||!1,u=t.ctrlKey||!1,f=t.metaKey||!1;if(1==n){if(R&&R(r,i,o,l,u,f)===!1)return a(t)}else if(2==n){if(S&&S(r,i,o,l,u,f)===!1)return a(t)}else if(3==n&&L&&L(r,i,o,l,u,f)===!1)return a(t);if((2==n||3==n)&&(V=null,z&&z(null,null,!1)),2==n&&Z)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:Z()}};r(B,"keydown",function(e){return te(e,1)}),r(B,"keypress",function(e){return te(e,2)}),r(B,"keyup",function(e){return te(e,3)});var ne=function(t,n){if(!t)var t=e.event;var r=null,o=null;t.clientX&&t.clientY?(r=t.clientX,o=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,o=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),i(X,"mouseup",ne),V=null,(M||!n)&&z&&z(r,o,n)};r(B,"mousedown",function(e){i(X,"mouseup",ne),r(X,"mouseup",ne)}),r(B,"mouseup",function(e){ne(e),Z&&Z()}),r(B,"dblclick",function(e){ne(e)}),r(B,"selectionchange",function(e){ne(e)}),M&&r(B,"contextmenu",function(e){return ne(e,!0),a(e)});var re=function(n,r,i){if(d(B,V),!y(B,i))return!1;if(e.getSelection)try{return t.queryCommandSupported&&!t.queryCommandSupported(n)?!1:t.execCommand(n,!1,r)}catch(o){}else if(t.selection){var a=t.selection;if("None"!=a.type){var l=a.createRange();try{return l.queryCommandEnabled(n)?l.execCommand(n,!1,r):!1}catch(o){}}}return!1},ie=null,oe=function(){(t.all||e.MSInputMethodContext)&&(ie=t.createElement("DIV"),B.appendChild(ie))},ae=function(e){ie&&(B.removeChild(ie),ie=null),Z&&Z(),e?(h(),V=null):V&&(V=s(B))};return{getElement:function(){return B},getHTML:function(){return B.innerHTML},setHTML:function(e){return B.innerHTML=e,ae(!0),this},getSelectedHTML:function(){return d(B,V),y(B)?T(B):null},sync:function(){return W&&W(),this},collapseSelection:function(){return h(),V=null,this},expandSelection:function(e,t){return d(B,V),y(B)?(m(B,e,t),V=s(B),this):this},openPopup:function(){return V||(V=s(B)),J()},closePopup:function(){return Q(),this},removeFormat:function(){return re("removeFormat"),re("unlink"),ae(),this},bold:function(){return re("bold"),ae(),this},italic:function(){return re("italic"),ae(),this},underline:function(){return re("underline"),ae(),this},strikethrough:function(){return re("strikeThrough"),ae(),this},forecolor:function(e){return re("foreColor",e),ae(),this},highlight:function(e){return re("hiliteColor",e)||re("backColor",e),ae(),this},fontName:function(e){return re("fontName",e),ae(),this},fontSize:function(e){return re("fontSize",e),ae(),this},subscript:function(){return re("subscript"),ae(),this},superscript:function(){return re("superscript"),ae(),this},align:function(e){return oe(),"left"==e?re("justifyLeft"):"center"==e?re("justifyCenter"):"right"==e?re("justifyRight"):"justify"==e&&re("justifyFull"),ae(),this},format:function(e){return oe(),re("formatBlock",e),ae(),this},indent:function(e){return oe(),re(e?"outdent":"indent"),ae(),this},insertLink:function(e){return re("createLink",e),ae(!0),this},insertImage:function(e){return re("insertImage",e,!0),ae(!0),this},insertHTML:function(e){return re("insertHTML",e,!0)||(d(B,V),y(B,!0),E(B,e)),ae(!0),this},insertList:function(e){return oe(),re(e?"insertOrderedList":"insertUnorderedList"),ae(),this}}};return C});